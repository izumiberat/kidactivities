<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayIdeas - Activity Generator for Parents</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--light);
            line-height: 1.6;
            color: var(--dark);
        }
        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 1.5rem;
            padding-top: 1rem;
        }
        .form-group {
            margin-bottom: 1.25rem;
            background: white;
            padding: 1.25rem;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        select, .materials, .duration-options {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }
        .materials, .duration-options {
            columns: 2;
            column-gap: 1rem;
        }
        @media (max-width: 480px) {
            .materials, .duration-options {
                columns: 1;
            }
        }
        .checkbox-item, .radio-item {
            margin-bottom: 0.5rem;
            break-inside: avoid;
            display: flex;
            align-items: center;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            font-weight: 600;
            transition: background-color 0.2s;
            margin-bottom: 1.25rem;
        }
        button:hover {
            background-color: var(--secondary);
        }
        #result {
            margin-top: 1.25rem;
            padding: 1.25rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: none;
        }
        .activity-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .activity-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            flex-wrap: wrap;
        }
        .favorite-btn {
            background-color: var(--warning);
            color: var(--dark);
            display: block;
            margin-top: 1rem;
        }
        .favorite-btn:hover {
            background-color: #e0a800;
        }
        .saved {
            background-color: var(--success);
            color: white;
        }
        #favorites-list {
            margin-top: 1.25rem;
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 1.25rem;
            gap: 0.25rem;
        }
        .tab-btn {
            flex: 1;
            border-radius: 8px 8px 0 0;
        }
        .tab-btn.active {
            background-color: var(--secondary);
        }
        .favorite-item {
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        input[type="checkbox"], 
        input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--primary);
        }
        .loading {
            text-align: center;
            padding: 1rem;
            color: #666;
        }
        .error {
            color: var(--danger);
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <h1>PlayIdeas Generator</h1>
    
    <div class="tab-buttons">
        <button class="tab-btn active" onclick="showTab('generator')">Get Ideas</button>
        <button class="tab-btn" onclick="showTab('favorites')">My Favorites</button>
    </div>
    
    <div id="generator-tab">
        <div class="form-group">
            <label for="age">Child's Age:</label>
            <select id="age" onchange="generateActivity()">
                <option value="0-2">0-2 years</option>
                <option value="3-5">3-5 years</option>
                <option value="6-8">6-8 years</option>
                <option value="9-12">9-12 years</option>
                <option value="12+">12+ years</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Location:</label>
            <div class="radio-item">
                <input type="radio" id="indoor" name="location" value="indoor" checked onchange="generateActivity()">
                <label for="indoor">üè† Indoor</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="outdoor" name="location" value="outdoor" onchange="generateActivity()">
                <label for="outdoor">üå≥ Outdoor</label>
            </div>
        </div>
        
        <div class="form-group">
            <label>Parent Availability:</label>
            <div class="radio-item">
                <input type="radio" id="available" name="availability" value="available" checked onchange="generateActivity()">
                <label for="available">üë®‚Äçüëß I can play too</label>
            </div>
            <div class="radio-item">
                <input type="radio" id="independent" name="availability" value="independent" onchange="generateActivity()">
                <label for="independent">üßí Need independent activity</label>
            </div>
        </div>
        
        <div class="form-group">
            <label>Duration:</label>
            <div class="duration-options">
                <div class="radio-item">
                    <input type="radio" id="quick" name="duration" value="quick" checked onchange="generateActivity()">
                    <label for="quick">‚è±Ô∏è Quick (&lt;15 min)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="medium" name="duration" value="medium" onchange="generateActivity()">
                    <label for="medium">‚è≥ Medium (15-30 min)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" id="long" name="duration" value="long" onchange="generateActivity()">
                    <label for="long">‚åõ Long (30+ min)</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label>Available Materials:</label>
            <div class="materials">
                <div class="checkbox-item"><input type="checkbox" id="paper" value="paper" onchange="generateActivity()"><label for="paper">üìÑ Paper</label></div>
                <div class="checkbox-item"><input type="checkbox" id="pencils" value="pencils" onchange="generateActivity()"><label for="pencils">‚úèÔ∏è Pencils/Markers</label></div>
                <div class="checkbox-item"><input type="checkbox" id="scissors" value="scissors" onchange="generateActivity()"><label for="scissors">‚úÇÔ∏è Scissors</label></div>
                <div class="checkbox-item"><input type="checkbox" id="tape" value="tape" onchange="generateActivity()"><label for="tape">üìè Tape/Glue</label></div>
                <div class="checkbox-item"><input type="checkbox" id="ball" value="ball" onchange="generateActivity()"><label for="ball">üèÄ Ball</label></div>
                <div class="checkbox-item"><input type="checkbox" id="blocks" value="blocks" onchange="generateActivity()"><label for="blocks">üß± Blocks/Lego</label></div>
                <div class="checkbox-item"><input type="checkbox" id="dolls" value="dolls" onchange="generateActivity()"><label for="dolls">üß∏ Dolls/Stuffed Animals</label></div>
                <div class="checkbox-item"><input type="checkbox" id="cards" value="cards" onchange="generateActivity()"><label for="cards">üÉè Playing Cards</label></div>
                <div class="checkbox-item"><input type="checkbox" id="blanket" value="blanket" onchange="generateActivity()"><label for="blanket">üõèÔ∏è Blanket</label></div>
                <div class="checkbox-item"><input type="checkbox" id="none" value="none" onchange="generateActivity()"><label for="none">‚ùå Nothing special</label></div>
            </div>
        </div>
        
        <button onclick="generateActivity()">Generate Play Idea!</button>
        
        <div id="result">
            <div class="loading">Loading activities...</div>
        </div>
    </div>
    
    <div id="favorites-tab" style="display: none;">
        <div id="favorites-list">
            <p>Loading favorites...</p>
        </div>
    </div>
    
    <script>
        // Global variables
        let activities = [];
        let favorites = [];
        let currentActivity = null;
        let activitiesLoaded = false;
        
        // Load activities from JSON file
        async function loadActivities() {
            try {
                console.log('Loading activities...');
                const response = await fetch('./activities.json?t=' + Date.now());
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                activities = data.activities || [];
                activitiesLoaded = true;
                console.log(`Loaded ${activities.length} activities`);
                
                // Load favorites after activities are loaded
                loadFavorites();
                
                // Generate initial activity
                generateActivity();
                
                // Update favorites list if we're on that tab
                updateFavoritesList();
                
            } catch (error) {
                console.error("Error loading activities:", error);
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="error">
                        Error loading activities: ${error.message}<br>
                        Please make sure activities.json is in the same directory as this HTML file.
                    </div>
                `;
                resultDiv.style.display = "block";
                activitiesLoaded = false;
            }
        }
        
        // Load favorites from localStorage
        function loadFavorites() {
            try {
                const stored = localStorage.getItem('playideas-favorites');
                favorites = stored ? JSON.parse(stored) : [];
                console.log(`Loaded ${favorites.length} favorites:`, favorites);
            } catch (error) {
                console.error('Error loading favorites:', error);
                favorites = [];
            }
        }
        
        // Save favorites to localStorage
        function saveFavorites() {
            try {
                localStorage.setItem('playideas-favorites', JSON.stringify(favorites));
                console.log('Saved favorites:', favorites);
            } catch (error) {
                console.error('Error saving favorites:', error);
            }
        }
        
        // Generate activity based on filters
        function generateActivity() {
            if (!activitiesLoaded || activities.length === 0) {
                return;
            }
            
            // Get user selections
            const age = document.getElementById("age").value;
            const location = document.querySelector('input[name="location"]:checked').value;
            const availability = document.querySelector('input[name="availability"]:checked').value;
            const duration = document.querySelector('input[name="duration"]:checked').value;
            
            // Get selected materials
            const materialCheckboxes = document.querySelectorAll('.materials input[type="checkbox"]:checked');
            const materials = Array.from(materialCheckboxes).map(cb => cb.value);
            
            console.log('Filters:', { age, location, availability, duration, materials });
            
            // Find matching activities
            let matchingActivities = activities.filter(activity => {
                const ageMatch = activity.age === age;
                const locationMatch = activity.location === location;
                const durationMatch = activity.duration === duration;
                const availabilityMatch = availability === "available" || activity.independent === true;
                
                return ageMatch && locationMatch && durationMatch && availabilityMatch;
            });
            
            console.log(`Found ${matchingActivities.length} activities after basic filters`);
            
            // Filter by materials if any are selected (and not just "none")
            if (materials.length > 0 && !(materials.length === 1 && materials[0] === "none")) {
                matchingActivities = matchingActivities.filter(activity => {
                    // If activity requires no materials, it matches
                    if (activity.materials.includes("none")) {
                        return true;
                    }
                    // Check if user has any of the required materials
                    return activity.materials.some(material => materials.includes(material));
                });
            }
            
            console.log(`Found ${matchingActivities.length} activities after material filters`);
            
            // Display result
            const resultDiv = document.getElementById("result");
            if (matchingActivities.length > 0) {
                const randomActivity = matchingActivities[Math.floor(Math.random() * matchingActivities.length)];
                currentActivity = randomActivity;
                const isFavorite = favorites.includes(randomActivity.id);
                
                console.log('Selected activity:', randomActivity);
                console.log('Is favorite:', isFavorite);
                
                resultDiv.innerHTML = `
                    <h3>Here's your play idea:</h3>
                    <div class="activity-meta">
                        <span>${randomActivity.independent ? "üßí Independent" : "üë®‚Äçüëß Parent-assisted"}</span>
                        <span>${randomActivity.duration === "quick" ? "‚è±Ô∏è Quick" : randomActivity.duration === "medium" ? "‚è≥ Medium" : "‚åõ Long"}</span>
                        <span>${randomActivity.location === "indoor" ? "üè† Indoor" : "üå≥ Outdoor"}</span>
                    </div>
                    <div class="activity-text">${randomActivity.text}</div>
                    <button class="favorite-btn ${isFavorite ? 'saved' : ''}" 
                            onclick="toggleFavorite(${randomActivity.id}, this)">
                        ${isFavorite ? '‚òÖ Saved to Favorites' : '‚òÜ Save to Favorites'}
                    </button>
                `;
            } else {
                resultDiv.innerHTML = `
                    <p>No exact matches found. Try:</p>
                    <ul>
                        <li>Selecting fewer materials</li>
                        <li>Changing duration or location</li>
                        <li>Checking 'Nothing special' if you don't have specific items</li>
                    </ul>
                `;
            }
            resultDiv.style.display = "block";
        }
        
        // Toggle activity favorite status
        function toggleFavorite(activityId, button) {
            console.log('Toggling favorite for activity ID:', activityId);
            const index = favorites.indexOf(activityId);
            
            if (index === -1) {
                favorites.push(activityId);
                button.textContent = '‚òÖ Saved to Favorites';
                button.classList.add('saved');
                console.log('Added to favorites');
            } else {
                favorites.splice(index, 1);
                button.textContent = '‚òÜ Save to Favorites';
                button.classList.remove('saved');
                console.log('Removed from favorites');
            }
            
            saveFavorites();
            updateFavoritesList();
        }
        
        // Update favorites list display
        function updateFavoritesList() {
            const favoritesList = document.getElementById("favorites-list");
            
            if (!activitiesLoaded) {
                favoritesList.innerHTML = "<p>Loading activities...</p>";
                return;
            }
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = "<p>You haven't saved any favorites yet. Generate some ideas and click 'Save to Favorites'!</p>";
                return;
            }
            
            console.log('Updating favorites list with:', favorites);
            
            let html = "<h3>Your Saved Favorites:</h3>";
            let foundFavorites = 0;
            
            favorites.forEach(favId => {
                const activity = activities.find(a => a.id === favId);
                if (activity) {
                    foundFavorites++;
                    console.log('Found favorite activity:', activity);
                    html += `
                        <div class="favorite-item">
                            <div class="activity-meta">
                                <span>${activity.independent ? "üßí Independent" : "üë®‚Äçüëß Parent-assisted"}</span>
                                <span>${activity.duration === "quick" ? "‚è±Ô∏è Quick" : activity.duration === "medium" ? "‚è≥ Medium" : "‚åõ Long"}</span>
                                <span>${activity.location === "indoor" ? "üè† Indoor" : "üå≥ Outdoor"}</span>
                                <span>Age ${activity.age}</span>
                            </div>
                            <div class="activity-text">${activity.text}</div>
                            <button onclick="removeFavorite(${activity.id})" style="background: var(--danger); padding: 0.25rem 0.5rem; font-size: 0.8rem; color: white;">Remove</button>
                        </div>
                    `;
                } else {
                    console.log('Activity not found for ID:', favId);
                }
            });
            
            if (foundFavorites === 0) {
                html += "<p>No favorite activities found. The activities database might have changed.</p>";
            }
            
            favoritesList.innerHTML = html;
            console.log(`Displayed ${foundFavorites} favorite activities`);
        }
        
        // Remove from favorites
        function removeFavorite(activityId) {
            console.log('Removing favorite:', activityId);
            favorites = favorites.filter(id => id !== activityId);
            saveFavorites();
            updateFavoritesList();
            
            // Update any visible favorite button in the results
            if (currentActivity && currentActivity.id === activityId) {
                const favBtn = document.querySelector('.favorite-btn');
                if (favBtn) {
                    favBtn.textContent = '‚òÜ Save to Favorites';
                    favBtn.classList.remove('saved');
                }
            }
        }
        
        // Switch between tabs
        function showTab(tabName) {
            console.log('Switching to tab:', tabName);
            document.getElementById('generator-tab').style.display = tabName === 'generator' ? 'block' : 'none';
            document.getElementById('favorites-tab').style.display = tabName === 'favorites' ? 'block' : 'none';
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(tabName));
            });
            
            if (tabName === 'favorites') {
                updateFavoritesList();
            }
        }
        
        // Initialize on load
        window.onload = function() {
            console.log('Page loaded, initializing...');
            loadActivities();
        };
        
        // Debug function to check current state
        function debugState() {
            console.log('Current state:');
            console.log('Activities loaded:', activitiesLoaded);
            console.log('Total activities:', activities.length);
            console.log('Current favorites:', favorites);
            console.log('Current activity:', currentActivity);
        }
        
        // Make debug function available globally
        window.debugState = debugState;
    </script>
</body>
</html>
